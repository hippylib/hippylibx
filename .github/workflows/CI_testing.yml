name: CI
on:
  push:
    branches:
      - main
  pull_request:

defaults:
  run:
    shell: bash -l {0}

jobs:
  style:
    runs-on: ubuntu-22.04
    container:
      # image: venuvgr/dolfinx_image:v2
      image: dolfinx/dolfinx:stable
      options: --user 1001 --privileged 
    name: CI test

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: ruff file checks
        run: |
          cd example/
          ruff check .
          ruff format --check .
          cd ..
          cd hippylibX/modeling/
          ruff check .
          ruff format --check .

      - name: run serial check
        run: |
          cd ./hippylibX/test && 
          mpirun -n 1 python3 testing_suite_file.py 

      - name: run parallel check
        run: |
          cd ./hippylibX/test && 
          mpirun -n 2 python3 testing_suite_file.py 


