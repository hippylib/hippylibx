name: CI
on:
  push:
    branches:
      - main
      - linter_branch #FIX ME: create pull request to main and get rid of this line
  pull_request:

defaults:
  run:
    shell: bash -l {0}

jobs:
  style:
    runs-on: ubuntu-22.04
    container:
      image: dolfinx/dolfinx:stable
      options: --user 1001 --privileged 
    name: CI test

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Set up python
        uses: actions/setup-python@v2
        with:
          python-version: 3.10.12

      # - name: Install dependencies
      #   run: |
      #     python3 -m pip install --upgrade pip
      #     pip install ruff

      # - name: ruff file checks
      #   run: |
      #     cd example/
      #     import ruff
      #     ruff check .
      #     ruff format --check .
      #     cd ..
      #     cd hippylibx/
      #     ruff check .
      #     ruff format --check .

      - name: run serial check
        run: |
          cd ./hippylibX/test && 
          mpirun -n 1 python3 testing_suite_file.py 

      - name: run parallel check
        run: |
          cd ./hippylibX/test && 
          mpirun -n 2 python3 testing_suite_file.py 


